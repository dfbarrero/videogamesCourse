%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% MUW Presentation
% LaTeX Template
% Version 1.0 (27/12/2016)
%
% License:
% CC BY-NC-SA 4.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
% Created by:
% Nicolas Ballarini, CeMSIIS, Medical University of Vienna
% nicoballarini@gmail.com
% http://statistics.msi.meduniwien.ac.at/
%
% Customized for UAH by:
% David F. Barrero, Departamento de Automática, UAH
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[10pt,compress]{beamer} % Change 10pt to make fonts of a different size
\mode<presentation>

\usepackage[spanish]{babel}
\usepackage{fontspec}
\usepackage{tikz}
\usepackage{etoolbox}
\usepackage{xcolor}
\usepackage{xstring}
\usepackage{listings}
\usepackage{tikz}
\usetikzlibrary{matrix,chains,positioning,decorations.pathreplacing,arrows,shapes}
\usepackage{pgf-umlcd} % Soporte para diagramas UML con Tikz
\usepackage{multicol}

\usepackage{minted} % Soporte para resaltado de sintaxis chula
\setminted{fontsize=\footnotesize,breaklines,linenos,highlightcolor=grisUAH}
%\setmintedinline{fontsize=\currentfontsize}
%\newcommand{\python}[2][python]{\mintinline{#1}{#2}}
\newcommand{\python}[2][\footnotesize]{\mintinline[fontsize=#1]{python}{#2}}

\usetheme{UAH}
\usecolortheme{UAH}
\setbeamertemplate{navigation symbols}{} 
\setbeamertemplate{caption}[numbered]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Presentation Info
\title{OOP in Arcade}
\author{\asignatura\\\carrera}
\institute{}
\date{Departamento de Automática}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Descomentar para habilitar barra de navegación superior
\setNavigation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Configuración de logotipos en portada
%% Opacidad de los logotipos
\newcommand{\opacidad}{1}
%% Descomentar para habilitar logotipo en pié de página de portada
%\renewcommand{\logoUno}{Images/isg.png}
%% Descomentar para habilitar logotipo en pié de página de portada
%\renewcommand{\logoDos}{Images/CCLogo.png}
%% Descomentar para habilitar logotipo en pié de página de portada
%\renewcommand{\logoTres}{Images/ALogo.png}
%% Descomentar para habilitar logotipo en pié de página de portada
%\renewcommand{\logoCuatro}{Images/ELogo.png}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% FOOTLINE
%% Comment/Uncomment the following blocks to modify the footline
%% content in the body slides. 


%% Option A: Title and institute
\footlineA
%% Option B: Author and institute
%\footlineB
%% Option C: Title, Author and institute
%\footlineC
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Use this block for a blue title slide with modified footline
{\titlepageBlue
    \begin{frame}
        \titlepage
    \end{frame}
}

\institute{\asignatura}

\begin{frame}[plain]{}
	\begin{block}{Objectives}
		\begin{enumerate}
		\item Understand the OO API in Arcade
		\item Use sprites and sprites sheets with Arcade
		\item Handle user input (mouse, keyboard and joysticks)
		\item Understand some multimedia file formats
		\item Introduce the \texttt{Window}, \texttt{View} and \texttt{Sprite} classes
		\end{enumerate}
	\end{block}

   	\begin{block}{Bibliography}
      		\begin{enumerate}
			%\item Paul Craven. \textit{The Arcade Book. Chapter 18: Using the Window class}. \href{https://learn.arcade.academy/en/latest/chapters/18\_window\_class/window\_class.html}{(link)}.
			%\item Paul Craven. \textit{The Arcade Book. Chapter 19: User control}. \href{https://learn.arcade.academy/en/latest/chapters/18\_window\_class/window\_class.html}{(link)}.
			%\item Paul Craven. \textit{The Arcade Book. Chapter 21: Spriters and collisions}. \href{https://learn.arcade.academy/en/latest/chapters/21\_sprites\_and\\_collisions/sprites.html}{(link)}.
			\item Paul Craven. \textit{Drawing \& Using Sprites}. \href{https://api.arcade.academy/en/3.3.3/programming_guide/sprites/index.html}{(link)}.
			\item Paul Craven. \textit{Keyboard}. \href{https://api.arcade.academy/en/3.3.3/programming_guide/keyboard.html}{(link)}.
			\item Paul Craven. \textit{Textures}. \href{https://api.arcade.academy/en/3.3.3/programming_guide/textures.html}{(link)}.
			\item Paul Craven. \textit{Using Views for Start/End Screens}. \href{https://api.arcade.academy/en/3.3.3/tutorials/views/index.html}{(link)}.
      		\end{enumerate} 
   	\end{block}
\end{frame}

{
\disableNavigation{white}
\begin{frame}[shrink]{Table of Contents}

 	\frametitle{Table of Contents}
  	\begin{multicols}{2}
  		\tableofcontents
    \end{multicols}

 %\frametitle{Table of Contents}
 %\tableofcontents
  % You might wish to add the option [pausesections]
\end{frame}
}

\section{The Window class}
\subsection{Introduction}

\begin{frame}{The \texttt{Window} class}{Introduction}
	Arcade has an OOP API
	\begin{itemize}
		\item More features than structured API
		\item Easy to use API
	\end{itemize}
	 This API is based on the \texttt{arcade.Window} class
	\medskip
	\begin{exampleblock}{}
		\inputminted[highlightlines={5}]{python}{code/window101.py}
%		\vspace{-0.2cm}
%		\lstinputlisting[numbers=left]{code/window101.py}
%		\vspace{-0.2cm}
	\end{exampleblock}
\end{frame}

\begin{frame}{The \texttt{Window} class}{Extending the \texttt{Window} class}
	\begin{exampleblock}{}
		\vspace{-0.2cm}
		\inputminted[highlightlines={4-9,13}]{python}{code/window102.py}
		\vspace{-0.2cm}
	\end{exampleblock}
\end{frame}



\subsection{Main methods and attributes}
\begin{frame}{The \texttt{Window} class}{Main methods and attributes}
	\begin{block}{\texttt{arcade.Window}}
		\smallskip
		\begin{columns}[t]
 	   \column{.6\textwidth}
			\centering \textbf{Methods}
		\begin{itemize}
		%\item \footnotesize{\texttt{setup()}}. \\Initialization
		\item \python{on_draw()}. \\Drawing
		\item \python{on_update(delta_time: float)}. \\Move everything. Perform collision checks. Do all the game logic here
		\bigskip
		\item \python{clear()}. \\Clear screen
		\item \python{set_background_color(color)}. \\Set color used by \python{clear()}
		\end{itemize}

 	   \column{.4\textwidth}
		\centering \textbf{Attributes}
		\begin{itemize}
			\item \python{background_color} \\ Color used by \python{clear()}
		\end{itemize}
    	\end{columns}
	\end{block}	
\end{frame}

\begin{frame}[plain]%{The \texttt{Window} class}{Main methods and attributes}
	\begin{exampleblock}{Ball}
		\vspace{-0.2cm}
		\inputminted{python}{code/window103.py}
		\vspace{-0.2cm}
	\end{exampleblock}
\end{frame}

\begin{frame}[plain]%{The \texttt{Window} class}{Main methods and attributes}
	\begin{exampleblock}{Animated ball}
		\vspace{-0.2cm}
		\inputminted[highlightlines={10,11,17,21,22}]{python}{code/window104.py}
		\vspace{-0.2cm}
	\end{exampleblock}
	It violates encapsulation, \href{https://learn.arcade.academy/en/latest/chapters/18_window_class/window_class.html}{(link to better solution)}
\end{frame}


\subsection{Basic methods}

\begin{frame}{The \texttt{Window} class}{Constructor}
	\begin{block}{Constructor}
		\vspace{-0.2cm}
		\inputminted{python}{code/window-init.py}
		\vspace{-0.2cm}
	\end{block}	

    Remember to use reference documentation
	\begin{itemize}
		\item \href{https://api.arcade.academy/en/2.6.17/api/window.html\#arcade.Window}{(\texttt{arcade.Window} reference)}
	\end{itemize}
        $\frac{1}{0.016666666666666666} = 60 Hz$
\end{frame}

\subsection{Other methods}

\begin{frame}{The \texttt{Window} class}{Other methods}
	Other methods
	%	\vspace{-0.15cm}
		\begin{itemize}
		\item \python{activate()}
		\item \python{center_window()}
		\item \python{close()}
		\item \python{get_location()}
		\item \python{get_size()}
		\item \python{maximize()} and \python{minimize()}
		\item \python{set_fullscreen(fullscreen: bool = True)}
		\item \python{set_location(x, y)}
		\end{itemize}
	%	\vspace{-0.2cm}
	Adding a \python{setup()} method is recommended
\end{frame}



%\subsection{Background}

%\begin{frame}{The \texttt{Window} class}{Background (I)}
%    \begin{exampleblock}{}
%	\vspace{-0.2cm}
%	\lstinputlisting[numbers=left]{code/background-1.py}
%	\vspace{-0.2cm}
%    \end{exampleblock}

%    \centering \href{https://api.arcade.academy/en/latest/arcade.color.html}{(List of colors)}

%    \bigskip

%    \begin{columns}
% 	   \column{.7\textwidth}
%		\begin{exampleblock}{}
%		\vspace{-0.2cm}
%		\lstinputlisting[numbers=left]{code/background-2.py}
%		\vspace{-0.2cm}
%		\end{exampleblock}

% 	   \column{.3\textwidth}
%		\includegraphics[width=\linewidth]{figs/rgb}\\
%    \end{columns}
%\end{frame}

%\begin{frame}[plain]{The \texttt{Window} class}{Background (II)}
%	\centering \includegraphics[width=0.4\linewidth]{figs/colors}\\
%	\tiny \href{https://www.rapidtables.com/convert/color/rgb-to-hex.html}{(Source)}
%\end{frame}

\section{User control}

\begin{frame}{User control}{Introduction}
    How does the player interact with the game?
	\begin{itemize}
	\item Mouse
	\item Keyboard
	\item Game controller (joystick or gamepad)
	\end{itemize}
	The key is to override Window methods
	\bigskip

    \begin{columns}
	   \column{.3\textwidth}
		\includegraphics[width=\linewidth]{figs/keyboard.jpg}\\
 	   \column{.3\textwidth}
		\includegraphics[width=\linewidth]{figs/mouse.jpg}\\
 	   \column{.3\textwidth}
		\includegraphics[width=\linewidth]{figs/gamepad.jpg}\\
    \end{columns}
\end{frame}

\subsection{Mouse}
\begin{frame}{User control}{Mouse (I)}
	Overriding the following \texttt{arcade.Window} methods
		\begin{itemize}
		\item \python{on_mouse_motion(x, y, delta_x, delta_y)}. \\ Called whenever the mouse moves.
		\item \python{on_mouse_press(x: float, y: float, button: int, modifiers: int)}. \\Called when the user presses a mouse button.
		\item \python{on_mouse_release(x: float, y: float, button: int, modifiers: int)}.  \\Called when the user releases a mouse button.
		\end{itemize}
	Make the mouse pointer dissapear:
	\begin{itemize}
		\item Call \python{self.set_mouse_visible(False)} the constructor
	\end{itemize}
\end{frame}

\begin{frame}{User control}{Mouse (II)}
	\begin{exampleblock}{Capturing a mouse click}
		\vspace{-0.2cm}
		\inputminted{python}{code/button.py}
		\vspace{-0.2cm}
	\end{exampleblock}

	\begin{exampleblock}{Moving a ball with a mouse}
		\href{https://gist.github.com/dfbarrero/17aea7bc1377b54729eb31d91ac97815}{(Example)}
	\end{exampleblock}

	\href{https://api.arcade.academy/en/3.3.3/api\_docs/arcade.key.html\#key}{(More info about keys)}
\end{frame}

\subsection{Keyboard}
\begin{frame}{User control}{Keyboard}
	Two \textbf{events} when we press a key
	\begin{itemize}
		\item Press and release
	\end{itemize}
	Overriding the following \python{arcade.Window} methods
		\begin{itemize}
		\item \python{on_key_press(symbol: int, modifiers: int)} \\Called when the user presses key.
		\item \python{on_key_release(symbol: int, modifiers: int)}. \\Called when the user releases key.
		\end{itemize}

    	\begin{columns}
 	   \column{.6\textwidth}
	\begin{exampleblock}{Capturing a key}
		\vspace{-0.2cm}
		\inputminted{python}{code/key.py}
		\vspace{-0.2cm}
	\end{exampleblock}
    	\end{columns}
	\bigskip
	\centering \centering \href{https://gist.github.com/dfbarrero/c71fde8f0424e126403aba19f3a9fd8a}{(Example)}
\end{frame}

\subsection{Game controller}
\begin{frame}{User control}{Game controller (I)}
	A computer might not have any controller, or it might five game controllers
	\begin{itemize}
		\item \python{arcade.get_joysticks() -> list(Joystick)} 
	\end{itemize}

	\bigskip

    	\begin{columns}
 	   \column{.5\textwidth}
	\begin{exampleblock}{Init controller in \texttt{\_\_init\_\_}}
		\vspace{-0.2cm}
		\inputminted{python}{code/joystick-get.py}
		\vspace{-0.2cm}
	\end{exampleblock}
	\end{columns}
\end{frame}

\begin{frame}{User control}{Game controller (II)}
    	\begin{columns}
 	   \column{.8\textwidth}
	\begin{exampleblock}{Read game controller value}
	\vspace{-0.2cm}
		\inputminted{python}{code/joystick-value.py}
	\vspace{-0.2cm}
	\end{exampleblock}	
	\end{columns}

	\bigskip

    \begin{columns}
 	   \column{.25\textwidth}
		\includegraphics[width=\linewidth]{figs/controller-centered.jpg}\\
		\centering Centered $(0,0)$
	   \column{.25\textwidth}
		\includegraphics[width=\linewidth]{figs/controller-down.jpg}\\
		\centering Down $(0,1)$
 	   \column{.25\textwidth}
		\includegraphics[width=\linewidth]{figs/controller-up.jpg}\\
		\centering Up $(0,-1)$
	   \column{.25\textwidth}
		\includegraphics[width=\linewidth]{figs/controller-downleft.jpg}\\
		\centering Down-left $(-1, 1)$
    \end{columns}

	\centering \tiny \href{https://learn.arcade.academy/en/latest/chapters/19\_user\_control/user\_control.html}{(Source)}

	\bigskip

	\normalsize
	\href{https://api.arcade.academy/en/2.6.17/examples/sprite\_move\_joystick.html}{(Interesting example - Arcade 2.6.17)}

\end{frame}

\section{The \texttt{View} class}
\subsection{The need for views}

\begin{frame}{The \texttt{View} class (I)}{The need for views}
	Videogames use to show several screens 
	\begin{itemize}
    		\item Start screens
    		\item Instruction screens
    		\item Game over screens
    		\item Pause screens
	\end{itemize}

	Arcade provides the \texttt{View} class
	\begin{itemize}
		\item Very much like the Window class
		\item It has the \texttt{on\_draw()} and \texttt{on\_update()} methods
	\end{itemize}


	\vspace{-3.5cm}
    \hfill \includegraphics[width=0.3\linewidth]{figs/screens.png}
	\tiny  \href{https://api.arcade.academy/en/stable/tutorials/views/index.html}{(Source)}
\end{frame}

\begin{frame}{The \texttt{View} class}{The \texttt{View} class (II)}

	Our class must inherit from \texttt{arcade.View}
	\begin{columns}
 	   %\column{.1\textwidth}
 	   \column{.4\textwidth}
		\begin{exampleblock}{}
		\python{class MyGame(arcade.Window):}
		\end{exampleblock}
 	   \column{.05\textwidth}
		$\Rightarrow$
 	   \column{.4\textwidth}
		\begin{exampleblock}{}
		\python{class GameView(arcade.View):}
		\end{exampleblock}
 	   \column{.05\textwidth}
	\end{columns}

	\bigskip

	The view does not control the window size, so
	\begin{columns}
 	   %\column{.1\textwidth}
 	   \column{.6\textwidth}
		\begin{exampleblock}{}
		\python{super().__init__(WIDTH, HEIGHT, TITLE)}
		\end{exampleblock}
 	   \column{.05\textwidth}
		$\Rightarrow$
 	   \column{.3\textwidth}
		\begin{exampleblock}{}
		\python{super().__init__()}
		\end{exampleblock}
 	   \column{.05\textwidth}
	\end{columns}

	\bigskip

	The mouse pointer is still controlled by the window, so
	\begin{columns}
 	   %\column{.1\textwidth}
 	   \column{.4\textwidth}
		\begin{exampleblock}{}
			\python{self.set_mouse_visible(False)}
		\end{exampleblock}
 	   \column{.05\textwidth}
		$\Rightarrow$
 	   \column{.5\textwidth}
		\begin{exampleblock}{}
			\python{self.window.set_mouse_visible(False)}
		\end{exampleblock}
 	   %\column{.05\textwidth}
	\end{columns}

\end{frame}

\begin{frame}[fragile]{The \texttt{View} class}{The \texttt{View} class (III)}
	Finally, we need to create a window, a view and show that view

	\begin{columns}
 	   \column{0.7\textwidth}
		\begin{exampleblock}{}
			\begin{minted}{python} 
def main():
    """ Main function """

    window = arcade.Window(WIDTH, HEIGHT, TITLE)
    start_view = GameView()
    window.show_view(start_view)
    start_view.setup()
    arcade.run()
\end{minted}
		\end{exampleblock}
	\end{columns}
\end{frame}

\subsection{Changing views}
\begin{frame}[fragile]{The \texttt{View} class}{Changing views}
	\begin{columns}
 	   \column{.5\textwidth}
		We can switch the view any time
		\begin{itemize}
			\item \python{show_view(view: View)}
		\end{itemize}


		\texttt{on\_view\_draw()}
		\begin{itemize}
		\item Run once when we switch to the view
		\end{itemize}

 	   \column{.5\textwidth}
		\begin{exampleblock}{From a view}
			\begin{minted}{python} 
def on_update(self, delta_time):
  
  [...]

  if len(self.coin_list) == 0:
    view = GameOverView()
    self.window.show_view(view)
\end{minted}
		\end{exampleblock}
	\end{columns}
\end{frame}

\subsection{Examples}

\begin{frame}[fragile, plain]{The \texttt{View} class}{Example: Game Over screen}
		\begin{exampleblock}{GameOverView view}
	\begin{minted}[highlightlines={7,12}]{python}
class GameOverView(arcade.View):
    """ View to show when game is over """

    def __init__(self):
        """ This is run once when we switch to this view """
        super().__init__()
        self.texture = arcade.load_texture("game_over.png")

    def on_draw(self):
        """ Draw this view """
        self.clear()
        self.texture.draw_sized(WIDTH / 2, HEIGHT / 2, WIDTH, HEIGHT)

    def on_mouse_press(self, _x, _y, _button, _modifiers):
        """ If the user presses the mouse button, re-start the game. """
        game_view = GameView()
        game_view.setup()
        self.window.show_view(game_view)
\end{minted}
\end{exampleblock}

	\centering \href{https://api.arcade.academy/en/3.3.3/example\_code/starting\_template.html\#starting-template}{(Starting template)}\\
\end{frame}


\subsection{Graphs}

\begin{frame}{The \texttt{View} class}{Graphs}
	\begin{columns}
 	   \column{.50\textwidth}
		\alert{Graph}: Data structure with \textbf{nodes} and \textbf{edges}

		\begin{itemize}
		\item Widely used in programming, AI and videogames
		\item Huge number of applications
		\end{itemize}

		Central role in \alert{path planning}
		\begin{itemize}
		\item \href{https://www.youtube.com/watch?v=tH9dNESH4ic}{(Video)}
		\item Navigation mesh
		\end{itemize}

 	   \column{.50\textwidth}
	   	\begin{tikzpicture}[scale=0.5]
		\tikzstyle{node_style} = [circle,draw=black]
	    	\tikzstyle{edge_style} = [draw=black]
		\node[node_style] (v1) at (-2,2) {2};
		\node[node_style] (v2) at (2,2) {3};
		\node[node_style] (v3) at (4,0) {6};
		\node[node_style] (v4) at (2,-2) {4};
		\node[node_style] (v5) at (-2,-2) {5};
		\node[node_style] (v6) at (-4,0) {1};
		\draw[edge_style] (v1) edge (v2);
		\draw[edge_style] (v2) edge (v3);
		\draw[edge_style] (v3) edge (v4);
		\draw[edge_style] (v4) edge (v5);
		\draw[edge_style] (v5) edge (v6);
		\draw[edge_style] (v6) edge (v1);
		\draw[edge_style] (v5) edge (v1);
		\draw[edge_style] (v5) edge (v2);
		\draw[edge_style] (v4) edge (v2);
	    	\end{tikzpicture}
    \end{columns}
\end{frame}

\subsection{Finite States Machines}

\begin{frame}{The \texttt{View} class}{Finite States Machines (I)}
	\begin{columns}
 	  \column{.50\textwidth}
		\begin{block}{Finite-State Machine (FSM)}
	    	A graph whose nodes represent states, usually associated with behaviours
		\end{block}
	\end{columns}

	\bigskip

	\begin{columns}
 	   \column{.20\textwidth}
		\includegraphics[width=\linewidth]{figs/turnstile}\\
 	   \column{.50\textwidth}
		\includegraphics[width=\linewidth]{figs/fsm}\\
		\centering \tiny \href{https://en.wikipedia.org/wiki/Finite-state\_machine}{(Source)}
	\end{columns}
\end{frame}

\begin{frame}{The \texttt{View} class}{Finite States Machines (II)}
	FSMs have many applications
	    \begin{itemize}
	    \item Central role in Theory of Computation
	    \item Good to model behaviours ... such as a NPC or an entire videogame
	    \end{itemize}

	\bigskip

	\begin{columns}
 	   \column{.5\textwidth}
		\centering NPC behaviour\\
		\includegraphics[width=\linewidth]{figs/fsm-pacman.png}\\
		\centering \tiny \href{http://bits.citrusbyte.com/state-design-pattern-with-ruby/}{(Source)}
 	   \column{.5\textwidth}
		\centering Game life-cycle \\
		\includegraphics[width=\linewidth]{figs/states}\\
	\end{columns}
\end{frame}

\section{The \texttt{Texture} class}
\subsection{Introduction}
\begin{frame}{The \texttt{Texture} class}{Introduction}
	\vspace{-1.5cm}
	\begin{center}
		\includegraphics[width=2cm]{figs/mario.jpg}\includegraphics[width=2cm]{figs/zelda.png}\\
	\end{center}
    \begin{columns}
 	   \column{.450\textwidth}
	    In Arcade, images are named \textbf{textures}
        \begin{itemize}
	\item Implemented by the \texttt{arcade.Texture} class
	\end{itemize}
    Two texture loading methods
        \begin{itemize}
		\item \texttt{arcade.load\_texture()}
		\item \texttt{arcade.Texture()}
	\end{itemize}
 	   \column{.6\textwidth}
	   \begin{exampleblock}{Functional}
		   \python[\scriptsize]{mario = arcade.load_texture("mario.png")}\\
		   \python[\scriptsize]{mario = arcade.load_texture(Path("mario.png"))}
	   \end{exampleblock}
	   \begin{exampleblock}{Object-oriented}
		   \python{mario = arcade.Texture("mario.png")}\\
		   \python{mario = arcade.Texture(Path("mario.png"))}
	   \end{exampleblock}
	\end{columns}
\end{frame}

\subsection{Hitboxes}
\begin{frame}{The \texttt{Texture} class}{Hitboxes}
    \begin{columns}
 	   \column{.55\textwidth}
	The \texttt{Texture} class provides
	\begin{itemize}
		\item Hitbox geometry, used in \alert{collision detection}
		\item Caching
	\end{itemize}
 	   \column{.35\textwidth}
		\includegraphics[width=\textwidth]{figs/collision}\\
	\end{columns}
	\bigskip

	\begin{columns}
 	   \column{.3\textwidth}
		\includegraphics[width=\linewidth]{figs/hitbox1.jpg}\\
 	   \column{.3\textwidth}
		\includegraphics[width=\linewidth]{figs/hitbox2.jpg}\\
 	   \column{.3\textwidth}
		\includegraphics[width=\linewidth]{figs/hitbox3.jpg}\\
	\end{columns}
		\centering \tiny \href{https://askagamedev.tumblr.com/post/716313460605075457/a-question-on-hitboxes-why-are-hitboxes-a}{(Source)}

\end{frame}



\subsection{Data formats}

\begin{frame}{The \texttt{Texture} class}{Data formats (I)}
    In genenal, any data can be stored in three forms
        \begin{itemize}
        \item Not compressed
        \item Compressed with loss
        \item Compressed without loss
	    \end{itemize}

    \begin{table}
    \centering
    \begin{tabular}{l|c|c|c}
                            & Image format & Sound format & Binary data\\\hline
    Not compressed          & BMP          & WAV  &  \\
    Compressed with loss    & JPG          & MP3  &  \\
    Compressed without loss & PNG, GIF     & -    & ZIP, bzip, rar, ... 
    \end{tabular}
    \end{table}
\end{frame}

\begin{frame}{The \texttt{Texture} class}{Data formats (II)}
    Attending to what information is stored in image format, there are two types of image formats:
        \begin{itemize}
            \item Bitmap: stores each pixel
                \begin{itemize}
                \item Scales bad
                \item Formats: JPG, PNG, BMP, GIF
                \end{itemize}

            \item Vectorial: stores coordinates
                \begin{itemize}
                \item Scales well
                \item Not supported by Arcade
                \item Formats: SVG, EPS
                \end{itemize}
	    \end{itemize}

    Many open assets for your games!
        \begin{itemize}
        \item \href{https://kenney.nl/assets}{(Kenney)}
        \end{itemize}
\end{frame}

\section{The \texttt{Sprite} class}
\subsection{Introduction}

\begin{frame}{The \texttt{Sprite} class}{Introduction}
    \begin{columns}
 	   \column{.50\textwidth}
	   \begin{block}{Sprite}
       A sprite is a 2D image used in videogames
	   \end{block}
   \end{columns}

    \bigskip

    \begin{columns}
 	   \column{.20\textwidth}
			\includegraphics[width=\linewidth]{figs/mario.jpg}\\
 	   \column{.20\textwidth}
			\includegraphics[width=\linewidth]{figs/zelda.png}\\
 	   \column{.50\textwidth}
			\includegraphics[width=\linewidth]{figs/mario-screenshot.png}
   \end{columns}
\end{frame}

\subsection{Sprites in Arcade}

\begin{frame}{The \texttt{Sprite} class}{Sprites in Arcade}
    \begin{columns}
 	   \column{.40\textwidth}
    In Arcade, a sprite contains ...
        \begin{itemize}
        \item One or more textures
        \item Texture size
        \item Image data
	\item Collision detection
	\end{itemize}
    Acts as a base class for (our) derived classes

 	   \column{.60\textwidth}
    Implemented in the \texttt{arcade.Sprite} class
	\begin{exampleblock}{}
		\python{luigi = arcade.Sprite('luigi.png')}\\
		\python{mario = arcade.Sprite(Path('mario.png'))}
	\end{exampleblock}
	Inherits from \texttt{arcade.BasicSprite}
    \end{columns}
\end{frame}

\begin{frame}[fragile]{The \texttt{Sprite} class}{Constructor}
	\begin{block}{Constructor}
		\vspace{-0.2cm}
		\inputminted{python}{code/sprite-init.py}
		\vspace{-0.2cm}
	\end{block}	
	\bigskip
	\centering
	\href{https://api.arcade.academy/en/3.3.3/api_docs/api/sprites.html}{(Reference documentation)}
\end{frame}

\subsection{Methods and attributes}
\begin{frame}[plain]{The \texttt{Sprite} class}{Methods and attributes (I)}
	\begin{block}{\texttt{arcade.Sprite}}
		\smallskip
		\begin{columns}[t]
 	   \column{.5\textwidth}
			\centering \textbf{Methods}
		\begin{itemize}
		\item \footnotesize{\texttt{update(delta\_time: float = 0.016)}}\\
		\item \footnotesize{\texttt{append\_texture(texture: Texture)}}\\
		\item \footnotesize{\texttt{set\_texture(texture\_no: int)}} \\
		\item \footnotesize{\texttt{update(delta\_time: float = 0.016)}} \\
		%\item \footnotesize{\texttt{update\_animation(delta\_time: float = 0.016)}} \\
		\item \footnotesize{\texttt{stop()}}\\
		\item \footnotesize{\texttt{kill()}}\\
		\item \footnotesize{\texttt{draw\_hit\_box()}}\\
		%\item \footnotesize{\texttt{update\_animation(delta\_time: float = 0.016)}} % BasicSprite
		\end{itemize}

 	   \column{.5\textwidth}
			\centering \textbf{Attributes}
		\begin{itemize}
		\item \footnotesize{center\_x: float} and \footnotesize{center\_y: float}.\\ Center of the sprite
		\item \footnotesize{change\_x: float} and \footnotesize{change\_y: float}.\\ Velocity in X and Y
		\item \footnotesize{texture: Texture}
		\item \footnotesize{textures: list[Texture]}
		\item \footnotesize{alpha: int [0-255]}
		\item \footnotesize{angle: float}
		\item \footnotesize{scale: tuple}
		\item \footnotesize{bottom: float} and \footnotesize{top: float}
		\item \footnotesize{left: float} and \footnotesize{right: float}
		\item \footnotesize{visible: bool}
		\end{itemize}
    	\end{columns}
	\end{block}	
\end{frame}

\begin{frame}{The \texttt{Sprite} class}{Methods and attributes (II)}
    \begin{columns}
 	   \column{.50\textwidth}
		\begin{exampleblock}{Placing a sprite}
			\python{mario.center_x = 300}\\
			\python{mario.center_y = 200}
		\end{exampleblock}

	   \column{.50\textwidth}
		\begin{exampleblock}{Moving a sprite}
			\python{mario.change_x = 10}\\
			\python{mario.change_y = 1}
		\end{exampleblock}
    \end{columns}

    \begin{columns}
 	   \column{.50\textwidth}
    \begin{exampleblock}{Chaging visibility}
		\inputminted{python}{code/visible.py}
    \end{exampleblock}
    \end{columns}
\end{frame}

\subsection{Animation example}
\begin{frame}[plain]%{The \texttt{Sprite} class}{Example: Explosion animation}
    \begin{columns}
 	   \column{\textwidth}
		\begin{exampleblock}{}
			\inputminted{python}{code/explosion.py}
		\end{exampleblock}
    \end{columns}

\bigskip

    \centering \href{https://api.arcade.academy/en/3.3.3/example\_code/sprite\_explosion\_bitmapped.html\#sprite-explosion-bitmapped}{(Complete example in python -m arcade.examples.sprite\_explosion\_bitmapped)}
\end{frame}

\subsection{Collision detection}

\begin{frame}{The \texttt{Sprite} class}{Collision detection}
	Methods in \texttt{arcade.Sprite} to detect collisions
		\begin{itemize}
			\item \footnotesize{\texttt{collides\_with\_list(sprite\_list: SpriteList) $\rightarrow$ list(SpriteType)}} 
		\item \footnotesize{\texttt{collides\_with\_point(point: Union[Tuple[float, float], List[float]]) $\rightarrow$ bool}} 
		\item \footnotesize{\texttt{collides\_with\_sprite(point: BasicSprite) $\rightarrow$ bool}} 
		\item \footnotesize{\texttt{draw\_hit\_box()}}
		\end{itemize}

	Functions in Arcade to detect collisions
		\begin{itemize}
		\item \footnotesize{\texttt{arcade.check\_for\_collision(sprite1: BasicSprite, sprite2: BasicSprite) $\rightarrow$ bool}} 
		\item \footnotesize{\texttt{arcade.check\_for\_collision\_with\_list(sprite: BasicSprite, sprite\_list: SpriteList) $\rightarrow$ bool}} 
		\end{itemize}

\end{frame}

%\subsection{Collision detection}
%\begin{frame}{The \texttt{Texture} class}{Collision detection}
%    Textures in Arcade implement \alert{collision detection} and handling
%
%	\begin{columns}
% 	   \column{.5\textwidth}
%		\includegraphics[width=\linewidth]{figs/collision}\\
%		%\vspace{-0.3cm}\tiny \href{https://stackoverflow.com/questions/46268139/2d-collision-detection-without-axis-alignment}{(Source)}
%	\end{columns}

%    Three values for \texttt{hit\_box\_algoritm}: `None`, `Simple` and `Detailed`

%    \begin{columns}
% 	   \column{.3\textwidth}
%		\includegraphics[width=\linewidth]{figs/hitbox-none}\\
%		\centering None'
%	   \column{.3\textwidth}
%		\includegraphics[width=\linewidth]{figs/hitbox-simple}\\
%		\centering 'Simple'
%	   \column{.3\textwidth}
%		\includegraphics[width=\linewidth]{figs/hitbox-detailed}\\
%		\centering 'Detailed'
%    \end{columns}
%\end{frame}


\subsection{Class hierarchy}

\begin{frame}{The \texttt{Sprite} class}{Class hierarchy}
	\begin{tikzpicture}
      \begin{class}[text width=3cm]{BasicSprite}{0,0}
      \end{class}

      \begin{class}[text width=3cm]{Sprite}{0,-2}
	      \inherit{BasicSprite}
      \end{class}

      \begin{class}[text width=3cm]{SpriteCircle}{-3,-4}
	\inherit{Sprite}
      \end{class}

	%\begin{class}[text width=3cm]{SpriteSolidColor}{0,-4}
	%\inherit{Sprite}
      %\end{class}

       \begin{class}[text width=3cm]{SpriteSolidColor}{3, -4}
	\inherit{Sprite}
      \end{class}
    \end{tikzpicture}

	\begin{itemize}
		\item \href{https://api.arcade.academy/en/3.3.3/api\_docs/api/sprites.html\#arcade.SpriteCircle}{(SpriteCircle documentation)}
		\item \href{https://api.arcade.academy/en/3.3.3/api\_docs/api/sprites.html\#arcade.SpriteSolidColor}{(SpriteSolidColor documentation)}
		%\item \href{https://api.arcade.academy/en/2.6.17/api/sprites.html\#arcade-animatedtimebasedsprite}{(SpriteAnimatedTimeBasedSprite documentation)}
	\end{itemize}
\end{frame}

\section{Sprite lists}
\subsection{Motivation}

\begin{frame}[fragile]{Sprite lists}{Motivation}
    \begin{columns}
 	   \column{0.5\textwidth}
	    Arcade heavily uses \textbf{sprite lists}
	\begin{itemize}
		\item Batch drawing (GPU optimization)
		\item Collision detection
		\item Debug drawing for hit boxes
	\end{itemize}
  
 	   \column{0.5\textwidth}
	\begin{exampleblock}{}
		\begin{minted}{python}
for sprite in sprites:
    sprite.draw() # Not in 3.X

sprite_list.draw()
		\end{minted}
	\end{exampleblock}
    \end{columns}

	\bigskip

    \begin{columns}
 	   \column{.3\textwidth}
		\includegraphics[width=\linewidth]{figs/hitbox-none}\\
%		\centering None'
	   \column{.3\textwidth}
		\includegraphics[width=\linewidth]{figs/hitbox-simple}\\
%		\centering 'Simple'
	   %\column{.3\textwidth}
%		\includegraphics[width=\linewidth]{figs/hitbox-detailed}\\
%		\centering 'Detailed'
    \end{columns}
\end{frame}

\subsection{Drawing with sprite lists}
\begin{frame}[fragile]{Sprite lists}{Drawing with sprite lists}
    \begin{columns}
	 	   \column{0.5\textwidth}
 	Drawing with sprite lists
	\begin{enumerate}
		\item Create a \texttt{SpriteList}
		\item Create and append \texttt{Sprite} instances
		\item Call \texttt{draw()}
	\end{enumerate}
 
	 	   \column{0.5\textwidth}
	\begin{exampleblock}{}
		\begin{minted}[linenos=false]{python}
wall_list = arcade.SpriteList()
		\end{minted}
	\end{exampleblock}

	\begin{exampleblock}{}
		\begin{minted}[linenos=false]{python}
wall = arcade.Sprite('boxCrate.png')
wall.center_x = 300
wall.center_y = 300

wall_list.append(wall)
		\end{minted}
	\end{exampleblock}

	\begin{exampleblock}{}
		\python{wall_list.draw()}
	\end{exampleblock}
	\end{columns}
\end{frame}

\begin{frame}[fragile]{Sprite lists}{Collision detection}
    	Sprites can be removed from a list
	\begin{exampleblock}{}
		\python{wall.remove_from_sprite_lists()}
	\end{exampleblock}

    Lists in Arcade also implement collision detection 
	\begin{exampleblock}{}
		\python{hit_list = arcade.check_for_collision_with_list(player_sprite, coin_list)}
    	\end{exampleblock}
	Complete example in \href{https://github.com/pythonarcade/arcade/blob/3.3.3/arcade/examples/sprite\_minimal.py}{(python -m arcade.examples.sprite\_minimal)}

    %Functional example in \href{https://gist.github.com/dfbarrero/83294a5ea218ca866b68558d4d64ba46}{(example)}
\end{frame}


\section{Resources management}

\subsection{Spritesheets}

\begin{frame}{Resources management}{Spritesheets (I)}
\vspace{-1cm}
    \begin{columns}
 	   \column{.50\textwidth}
    A videogame contains many sprites
        \begin{itemize}
        \item Difficult maintenance
        \item Solution: Spritesheets
	    \end{itemize}

    Advantages
        \begin{itemize}
        \item One file contains many sprites
        \item Less I/O operations $\Rightarrow$ Better performance
        \item Less memory consumption
	    \end{itemize}
 	   \column{.50\textwidth}
		\includegraphics[width=\linewidth]{figs/mario-spritesheet.png}

		\includegraphics[width=\linewidth]{figs/blocks1.png}
   \end{columns}
\end{frame}

\begin{frame}{Resources management}{Spritesheets (II)}
    Arcade provides the \texttt{arcade.SpriteSheet} class
        \begin{itemize}
        \item Gets sprites from a spritesheet
	\end{itemize}

    \bigskip
    \centering

    \begin{columns}
 	   \column{.40\textwidth}
		\includegraphics[width=\linewidth]{figs/explosion.png}

 	   \column{.40\textwidth}
		\includegraphics[width=\linewidth]{figs/tiles.png}
   \end{columns}
\end{frame}

\subsection{Tile maps}

\begin{frame}{Resources management}{Tile maps}
    Locating sprites in the game is a tought work
    \begin{itemize}
        \item Closely related to \alert{level design}
        \item There are tools that ease this task
	\item Stores maps as JSON files
	\item Supported by \texttt{arcade.TileMap}
    \end{itemize}
    \href{https://www.mapeditor.org/}{(Tiled Map Editor)}

	\vspace{-2.5cm}
    \hfill \includegraphics[width=0.3\linewidth]{figs/tiled}
\end{frame}


\begin{frame}{Resources management}{Resources handlers}
    \includegraphics[width=0.07\linewidth]{figs/bumper}
    \includegraphics[width=0.07\linewidth]{figs/laserBlue01}
    \includegraphics[width=0.07\linewidth]{figs/tileGrass_roadSplitE}
    \includegraphics[width=0.07\linewidth]{figs/coinGold_ul}
    \includegraphics[width=0.07\linewidth]{figs/frog\_move}
    \includegraphics[width=0.07\linewidth]{figs/planet}
    \includegraphics[width=0.07\linewidth]{figs/stoneHill\_left}
    \includegraphics[width=0.07\linewidth]{figs/water}
    \includegraphics[width=0.07\linewidth]{figs/cardSpades5}
    \includegraphics[width=0.07\linewidth]{figs/slimeBlue}
    \includegraphics[width=0.07\linewidth]{figs/femaleAdventurer\_walk3}
    \includegraphics[width=0.07\linewidth]{figs/zombie\_idle}

    \bigskip

    Arcade comes along a collection of built-in resources
    \begin{itemize}
        \item Good for testing
        \item No need of files in the project
    \end{itemize}

	The path is something like \python[\normalsize]{':resources:/path/to/resource'}

    \begin{columns}
 	   \column{.80\textwidth}
    \begin{exampleblock}{}
	    \python{arcade.Sprite(":resources:images/items/coinGold.png") }
    \end{exampleblock}
    \end{columns}

\end{frame}

%\begin{frame}{Resources management (II)}
%	\begin{exampleblock}{Adding new resources handlers}
%	\lstinputlisting[numbers=left]{code/resources-1.py}
%	\end{exampleblock}

%	\begin{exampleblock}{Using resources handlers}
%	\lstinputlisting[numbers=left]{code/resources-2.py}
%	\end{exampleblock}
%\end{frame}

\subsection{Built-in resources}

\begin{frame}{Resources management}{Built-in resources}
    Type of built-in resources
    \begin{itemize}
	\item Images (characters, backgrounds, etc)
        \item Sounds and music
	\item Fonts
	\item GUI basic assets (such as bottons and checkboxes)
	\item Tile maps
    \end{itemize}

    \href{https://api.arcade.academy/en/3.3.3/api_docs/resources.html\#resources}{(List of resources)}\\
    \href{https://github.com/pythonarcade/arcade/tree/development/arcade/resources/assets}{(Source code)}\\
\end{frame}



\end{document}
