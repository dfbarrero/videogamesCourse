%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% MUW Presentation
% LaTeX Template
% Version 1.0 (27/12/2016)
%
% License:
% CC BY-NC-SA 4.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
% Created by:
% Nicolas Ballarini, CeMSIIS, Medical University of Vienna
% nicoballarini@gmail.com
% http://statistics.msi.meduniwien.ac.at/
%
% Customized for UAH by:
% David F. Barrero, Departamento de Automática, UAH
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[10pt,compress]{beamer} % Change 10pt to make fonts of a different size
\mode<presentation>

\usepackage[spanish]{babel}
\usepackage{fontspec}
\usepackage{tikz}
\usepackage{etoolbox}
\usepackage{xcolor}
\usepackage{xstring}
\usepackage{listings}

% Introduced by David
\usepackage{eurosym}

\usetheme{UAH}
\usecolortheme{UAH}
\setbeamertemplate{navigation symbols}{} 
\setbeamertemplate{caption}[numbered]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Presentation Info
\title[Videogames architecture]{Videogames architecture}
\author{}
\institute{\asignatura}
\date{}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Descomentar para habilitar barra de navegación superior
\ponerNavegacion
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Configuración de logotipos en portada
%% Opacidad de los logotipos
\newcommand{\opacidad}{1}
%% Descomentar para habilitar logotipo en pié de página de portada
\renewcommand{\logoUno}{Images/isg.png}
%% Descomentar para habilitar logotipo en pié de página de portada
%\renewcommand{\logoDos}{Images/CCLogo.png}
%% Descomentar para habilitar logotipo en pié de página de portada
%\renewcommand{\logoTres}{Images/ALogo.png}
%% Descomentar para habilitar logotipo en pié de página de portada
%\renewcommand{\logoCuatro}{Images/ELogo.png}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% FOOTLINE
%% Comment/Uncomment the following blocks to modify the footline
%% content in the body slides. 


%% Option A: Title and institute
\footlineA
%% Option B: Author and institute
%\footlineB
%% Option C: Title, Author and institute
%\footlineC
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Use this block for a blue title slide with modified footline
{\titlepageBlue
    \setbeamertemplate{headline}{}
	\setbeamercolor{frametitle}{bg=black}
	\setbeamercolor{normal text}{bg=black}
    \begin{frame}
        \titlepage
    \end{frame}
}

\begin{frame}[plain]{}
   \begin{block}{Objectives}
   \begin{itemize}
        \item Introduce the main videogame subsystems
        \item Deep understanding of the main loop
        \item Describe different main loop implementation methods
	\end{itemize}
	\end{block}

   \begin{block}{Bibliography}
      \begin{enumerate}
          \item  \textit{Desarrollo de Videojuegos, Arquitectura del Motor de Videojuegos}. Capitulo 1, sección 2. UCLM.
      \end{enumerate} 
   \end{block}
\end{frame}

{
\eliminarNavegacion
\begin{frame}[shrink]{Table of Contents}
 \frametitle{Table of Contents}
 \tableofcontents
  % You might wish to add the option [pausesections]
\end{frame}
}

\section{Videogame models}
\subsection{Render loop}
\begin{frame}{Videogame models}{Render loop (I)}
    \begin{columns}
 	   \column{.5\textwidth}
		\begin{itemize}
	   	\item The render loop handles visualization and rendering
	   	\item Objectives in 2D games
		\begin{itemize}
			\item Minimize pixels to draw: Draw only those pixels that have changed
			\item Maximize fps
		\end{itemize}
		\end{itemize}
 	   \column{.5\textwidth}
	\centering\includegraphics[width=0.8\linewidth]{figs/rendering}\\
	Render example
 	\end{columns}
	\begin{itemize}
	\item Objectives in 3D games
		\begin{itemize}
			\item Camera uses to change everytime: The same technique cannot be used
			\item Minimize the number of primites to draw in each iteration of the render loop
		\end{itemize}
	\end{itemize}
\end{frame}

\begin{frame}{Videogame models}{Render loop (II)}
	    \vspace{-0.2cm}
    \begin{block}{Render loop}
	    \vspace{-0.2cm}
	    \lstinputlisting[language=java, basicstyle=\ttfamily\scriptsize]{code/renderloop.java}
		\vspace{-0.2cm}
	\end{block}
	Info: \url{http://wiki.wxwidgets.org/Making\_a\_render\_loop}
\end{frame}


\subsection{Game loop}
\begin{frame}{Videogame models}{Game loop (I)}
	   	The main element in a videogame is the \alert{game loop}
		\begin{itemize}
			\item It is the main control structure in the game
			\item It controls its execution
			\item It handlers the transitions among states
			\item The game loop independizes the game execution from the hardware
		\end{itemize}
		Classical programs only reacts with user actions
		\begin{itemize}
			\item Videogames are always performing an action
			\item Game loop implements this easely
			\item The game engine contains the game loop
		\end{itemize}
\end{frame}

\begin{frame}{Videogame models}{Game loop (II)}
		\begin{itemize}
		   	\item There are many subsystems in a videogame
			\begin{itemize}
				\item Rendering engine (render is to generate an image)
				\item Collition detection
				\item Collition handling
				\item AI subsystem
					\item Game subsystem
			\end{itemize}
			\item Most of these subsystems require periodic updates
			\item The most critical one is the animation system
			\begin{itemize}
				\item Frequency: 30 or 60 Hz
				\item Syncronized with the rendering subsystem
				\item Objective: Provide a good fps rate to generate a realistic experience
			\end{itemize}
			\item Not all the components are so strict, for instance, AI
		\end{itemize}
\end{frame}

\begin{frame}{Videogame models}{Game loop (III)}
	\begin{itemize}
	   	\item There are several ways to implement the game loop
	   	\item The easiest one is to have several loops within the game loop
		\begin{itemize}
			\item Render loop
			\item AI loop
			\item Multimedia loop
			\item Iteration loop
		\end{itemize}
	\end{itemize}

    \begin{columns}
 	   \column{.4\textwidth}
    \begin{block}{Basic game loop}
	    \vspace{-0.2cm}
	    \lstinputlisting[language=java, basicstyle=\ttfamily\scriptsize]{code/gameloop1.java}
		\vspace{-0.2cm}
	\end{block}
   \column{.6\textwidth}
    \begin{block}{Game loop}
	    \vspace{-0.2cm}
	    \lstinputlisting[language=java, basicstyle=\ttfamily\scriptsize]{code/gameloop2.java}
		\vspace{-0.2cm}
	\end{block}
	\end{columns}
\end{frame}

\begin{frame}{Videogame models}{Game loop (IV)}
	    \vspace{-0.3cm}
    \begin{columns}
 	   \column{.7\textwidth}
    \begin{block}{}
	    \vspace{-0.2cm}
	    \lstinputlisting[language=c, basicstyle=\ttfamily\scriptsize]{code/pong.c}
		\vspace{-0.2cm}
	\end{block}
   \column{.3\textwidth}
   	Pong game loop example
	\centering\includegraphics[width=\linewidth]{figs/pong.jpeg}
	\end{columns}
\end{frame}

\begin{frame}[plain]{Videogame models}{Game loop (V)}
	\centering\includegraphics[width=\linewidth]{figs/gameloops}
\end{frame}

\begin{frame}{Videogame models}{Game loop (VI)}
	    The game loop depends on the platform
		\begin{itemize}
			\item DOS games and some consoles are designed to exploit computational resources
			\item PC games depend on limitations imposed by the OS
			\item Games use to be multithreaded to exploit multicore machines
		\end{itemize}
\end{frame}

\section{Game architectures}
\subsection{Game architectures}

\begin{frame}{Game architectures}{Game architectures}
    Game loop can be implemented in different ways
	\begin{itemize}
		\item Architectures based on callbacks
		\item Architectures based on events
		\item Architectures based on state machines
	\end{itemize}
	Most of them implement one or more control loops
\end{frame}

\subsection{Callbacks}
\begin{frame}{Game architectures}{Callbacks (I)}
	\begin{itemize}
		\item \textbf{Callbacks}: Code that is executed to handle an event
		\begin{itemize}
			\item Function or object
			\item Callbacks are used to ``fill'' source code
		\end{itemize}
		\item Related term: \textbf{framework}
		\begin{itemize}
			\item Application partially completed that the developer has to complete
		\end{itemize}
	\end{itemize}
\end{frame}

\begin{frame}{Videogame models}{Callbacks (II)}
	\vspace{-0.3cm}
    \begin{columns}
 	   	\column{.9\textwidth}
    		\begin{block}{}
	    	\vspace{-0.2cm}
	    	\lstinputlisting[language=c, basicstyle=\ttfamily\scriptsize]{code/callback.c}
			\vspace{-0.2cm}
			\end{block}
	\end{columns}
\end{frame}

\subsection{Events}
\begin{frame}{Game architectures}{Events}
	\begin{itemize}
		\item An event represents a change in the game state
		\item Two types
		\begin{itemize}
			\item \textbf{External}: Generated by the interactions\\Example, The player press a key or moves the joystick
			\item \textbf{Internal}: Generated by the game logic\\Example, NPC respawn
		\end{itemize}
		\item Most game engines include an event subsystem
		\begin{itemize}
			\item Closely related to the \textit{Observer} pattern
		\end{itemize}

	\end{itemize}
\end{frame}

\subsection{State machine}
\begin{frame}{Game architectures}{State machine}
	\vspace{-0.3cm}
	A game goes through a number of \alert{states}
		\begin{itemize}
			\item Introduction
			\item Main menu
			\item Game
			\item Game over
		\end{itemize}
	\textbf{State machine}: A set of states and transitions
	\vspace{0.3cm}
	\includegraphics[width=0.7\linewidth]{figs/states}\\
	\vspace{-0.2cm}
	Warning: State machines play a mayor role in game AI
\end{frame}



\end{document}
